1. Tests using TOSING_160T_dma_ddr3 design with no IOMMU
========================================================

The TOSING_160T_dma_ddr3 design was used in a i5-2310 system which doesn't have an IOMMU.

The following was temporarily added to the command line to allocate physical memory for the cmem_gdb_access driver:
  memmap=2050M$4G,1M$6146M

Using default arguments, which results in transfers which are not word aligned:
[mr_halfword@haswell-alma release]$ xilinx_dma_bridge_for_pcie/test_dma_accessible_memory 
Opening device 0000:01:00.0 (10ee:7024) with IOMMU group 0
Enabling bus master for 0000:01:00.0
Testing TOSING_160T_dma_ddr3 design with memory size 0x40000000
PCI device 0000:01:00.0 IOMMU group 0
Opened DMA MEM device : /dev/cmem (dev_desc = 0x00000007)
Debug: mmap param length 0x1000, Addr: 0x100000000 
Buff num 0: Phys addr : 0x100000000 User Addr: 0x7f2c2a43a000 
Debug: mmap param length 0x40000000, Addr: 0x100001000 
Buff num 0: Phys addr : 0x100001000 User Addr: 0x7f2be9a24000 
Debug: mmap param length 0x40000000, Addr: 0x140001000 
Buff num 0: Phys addr : 0x140001000 User Addr: 0x7f2ba9a24000 
Size of DMA descriptors used for h2c: [0]=0xfffffff [1]=0xfffffff [2]=0xfffffff [3]=0xfffffff [4]=0x4
Size of DMA descriptors used for c2h: [0]=0xfffffff [1]=0xfffffff [2]=0xfffffff [3]=0xfffffff [4]=0x4
Test pattern pass
host-to-card DMA timing for 16 transfers of 1073741824 bytes:
   Min = 836.020419 (Mbytes/sec)
  Mean = 836.178502 (Mbytes/sec)
   Max = 836.356822 (Mbytes/sec)
card-to-host DMA timing for 16 transfers of 1073741824 bytes:
   Min = 834.552247 (Mbytes/sec)
  Mean = 834.702048 (Mbytes/sec)
   Max = 834.819760 (Mbytes/sec)
Memory Driver closed 

With page size alignment for transfers, which has no effect on the transfer rate:
[mr_halfword@haswell-alma release]$ xilinx_dma_bridge_for_pcie/test_dma_accessible_memory -a 4096
Opening device 0000:01:00.0 (10ee:7024) with IOMMU group 0
Enabling bus master for 0000:01:00.0
Testing TOSING_160T_dma_ddr3 design with memory size 0x40000000
PCI device 0000:01:00.0 IOMMU group 0
Opened DMA MEM device : /dev/cmem (dev_desc = 0x00000007)
Debug: mmap param length 0x1000, Addr: 0x100000000 
Buff num 0: Phys addr : 0x100000000 User Addr: 0x7f0b4e281000 
Debug: mmap param length 0x40000000, Addr: 0x100001000 
Buff num 0: Phys addr : 0x100001000 User Addr: 0x7f0b0d86b000 
Debug: mmap param length 0x40000000, Addr: 0x140001000 
Buff num 0: Phys addr : 0x140001000 User Addr: 0x7f0acd86b000 
Size of DMA descriptors used for h2c: [0]=0xffff000 [1]=0xffff000 [2]=0xffff000 [3]=0xffff000 [4]=0x4000
Size of DMA descriptors used for c2h: [0]=0xffff000 [1]=0xffff000 [2]=0xffff000 [3]=0xffff000 [4]=0x4000
Test pattern pass
host-to-card DMA timing for 16 transfers of 1073741824 bytes:
   Min = 835.930008 (Mbytes/sec)
  Mean = 836.092384 (Mbytes/sec)
   Max = 836.261624 (Mbytes/sec)
card-to-host DMA timing for 16 transfers of 1073741824 bytes:
   Min = 834.649540 (Mbytes/sec)
  Mean = 834.695353 (Mbytes/sec)
   Max = 834.785671 (Mbytes/sec)
Memory Driver closed 


2. Test using Nitefury Project-0 and dma_blkram designs with IOMMU enabled
==========================================================================

The Nitefury Project-0 and dma_blkram designs were used in a W-2123 system with the IOMMU and secure boot enabled. 

Using default arguments, which for the Nitefury Project-0 design results in transfers which are not word aligned:
[mr_halfword@skylake-alma release]$ xilinx_dma_bridge_for_pcie/test_dma_accessible_memory 
Opening device 0000:15:00.0 (10ee:7024) with IOMMU group 41
Enabling bus master for 0000:15:00.0
Opening device 0000:2e:00.0 (10ee:7011) with IOMMU group 87
Enabling bus master for 0000:2e:00.0
Testing dma_blkram (TEF1001) design with memory size 0x120000
PCI device 0000:15:00.0 IOMMU group 41
Size of DMA descriptors used for h2c: [0]=0x120000
Size of DMA descriptors used for c2h: [0]=0x120000
Test pattern pass
host-to-card DMA timing for 14564 transfers of 1179648 bytes:
   Min = 1446.425221 (Mbytes/sec)
  Mean = 1755.580095 (Mbytes/sec)
   Max = 1757.884902 (Mbytes/sec)
card-to-host DMA timing for 14564 transfers of 1179648 bytes:
   Min = 1375.132746 (Mbytes/sec)
  Mean = 1405.979819 (Mbytes/sec)
   Max = 1406.244636 (Mbytes/sec)
Testing Nitefury Project-0 design version 0x2 with memory size 0x40000000
PCI device 0000:2e:00.0 IOMMU group 87
Size of DMA descriptors used for h2c: [0]=0xfffffff [1]=0xfffffff [2]=0xfffffff [3]=0xfffffff [4]=0x4
Size of DMA descriptors used for c2h: [0]=0xfffffff [1]=0xfffffff [2]=0xfffffff [3]=0xfffffff [4]=0x4
Test pattern pass
host-to-card DMA timing for 16 transfers of 1073741824 bytes:
   Min = 1325.816988 (Mbytes/sec)
  Mean = 1325.819613 (Mbytes/sec)
   Max = 1325.820986 (Mbytes/sec)
card-to-host DMA timing for 16 transfers of 1073741824 bytes:
   Min = 1130.562019 (Mbytes/sec)
  Mean = 1130.570527 (Mbytes/sec)
   Max = 1130.578031 (Mbytes/sec)


With page size alignment for transfers, which has no effect on the transfer rate:
[mr_halfword@skylake-alma release]$ xilinx_dma_bridge_for_pcie/test_dma_accessible_memory -a 4096
Opening device 0000:15:00.0 (10ee:7024) with IOMMU group 41
Enabling bus master for 0000:15:00.0
Opening device 0000:2e:00.0 (10ee:7011) with IOMMU group 87
Enabling bus master for 0000:2e:00.0
Testing dma_blkram (TEF1001) design with memory size 0x120000
PCI device 0000:15:00.0 IOMMU group 41
Size of DMA descriptors used for h2c: [0]=0x120000
Size of DMA descriptors used for c2h: [0]=0x120000
Test pattern pass
host-to-card DMA timing for 14564 transfers of 1179648 bytes:
   Min = 1706.175450 (Mbytes/sec)
  Mean = 1754.846234 (Mbytes/sec)
   Max = 1756.536863 (Mbytes/sec)
card-to-host DMA timing for 14564 transfers of 1179648 bytes:
   Min = 1361.628255 (Mbytes/sec)
  Mean = 1405.971441 (Mbytes/sec)
   Max = 1406.229548 (Mbytes/sec)
Testing Nitefury Project-0 design version 0x2 with memory size 0x40000000
PCI device 0000:2e:00.0 IOMMU group 87
Size of DMA descriptors used for h2c: [0]=0xffff000 [1]=0xffff000 [2]=0xffff000 [3]=0xffff000 [4]=0x4000
Size of DMA descriptors used for c2h: [0]=0xffff000 [1]=0xffff000 [2]=0xffff000 [3]=0xffff000 [4]=0x4000
Test pattern pass
host-to-card DMA timing for 16 transfers of 1073741824 bytes:
   Min = 1325.805850 (Mbytes/sec)
  Mean = 1325.818622 (Mbytes/sec)
   Max = 1325.820957 (Mbytes/sec)
card-to-host DMA timing for 16 transfers of 1073741824 bytes:
   Min = 1130.579250 (Mbytes/sec)
  Mean = 1130.612202 (Mbytes/sec)
   Max = 1130.638191 (Mbytes/sec)
